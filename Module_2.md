# –ú–æ–¥—É–ª—å 2: –°–∏—Å—Ç–µ–º–Ω–æ–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ (1.5 —á–∞—Å–∞)

## üìã –ó–∞–¥–∞–Ω–∏–µ 1: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä Samba –Ω–∞ –º–∞—à–∏–Ω–µ BR-SRV.

**–ó–∞–¥–∞–Ω–∏–µ 1**:
- –°–æ–∑–¥–∞–π—Ç–µ 5 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –æ—Ñ–∏—Å–∞ HQ: –∏–º–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ñ–æ—Ä–º–∞—Ç–∞ user‚Ññ.hq. –°–æ–∑–¥–∞–π—Ç–µ –≥—Ä—É–ø–ø—É hq, –≤–≤–µ–¥–∏—Ç–µ –≤ —ç—Ç—É –≥—Ä—É–ø–ø—É —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –í–≤–µ–¥–∏—Ç–µ –≤ –¥–æ–º–µ–Ω –º–∞—à–∏–Ω—É HQ-CLI
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≥—Ä—É–ø–ø—ã hq –∏–º–µ—é—Ç –ø—Ä–∞–≤–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º –ü–ö
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≥—Ä—É–ø–ø—ã hq –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—ã—à–∞—Ç—å –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –∫–æ–º–∞–Ω–¥: cat, grep, id. –ó–∞–ø—É—Å–∫–∞—Ç—å –¥—Ä—É–≥–∏–µ –∫–æ–º–∞–Ω–¥—ã —Å –ø–æ–≤—ã—à–µ–Ω–Ω—ã–º–∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≥—Ä—É–ø–ø—ã –Ω–µ –∏–º–µ—é—Ç –ø—Ä–∞–≤–∞
- –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∏–º–ø–æ—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ —Ñ–∞–π–ª–∞ users.csv. –§–∞–π–ª –±—É–¥–µ—Ç —Ä–∞—Å–ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ BR-SRV –≤ –ø–∞–ø–∫–µ /opt

> **–í–∞–∂–Ω–æ**: –î–ª—è –∏–º–ø–æ—Ä—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ users.csv –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç, –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ —è –Ω–µ –Ω–∞—à–µ–ª —Å–∫—Ä–∏–ø—Ç–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ –±—ã –ø–µ—Ä–µ–Ω–æ—Å–∏–ª–∏ –≤—Å–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–æ—Ç–æ—Ä—ã–µ —É–∫–∞–∑–∞–Ω—ã –≤ /opt/users.csv, –ø–æ—ç—Ç–æ–º—É —è –Ω–∞–ø–∏—Å–∞–ª —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç, –µ–≥–æ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ [—Ç—É—Ç](https://github.com/meowehh/samba-import).

### BR-SRV
```bash
apt-get update && apt-get install -y task-samba-dc alterator-fbi alterator-net-domain admx-* admc gpui
```
```bash
vim /etc/sysconfig/network
HOSTNAME=br-srv.au-team.irpo
```
```bash
reboot
```
```bash
systemctl enable --now ahttpd alteratord
rm -rf /etc/samba/smb.conf /var/{lib.cache}/samba
mkdir -p /var/lib/samba/sysvol
```
```bash
rm -rf /etc/net/ifaces/ens18/resolv.conf
systemctl restart network
vim /etc/resolvconf.conf
name_servers=127.0.0.1
name_servers=192.168.1.10
resolvconf -u
systemctl restart network
```
```bash
samba-tool domain provision --realm=au-team.irpo --domain=au-team --adminpass='P@ssw0rd' --dns-backend=BIND9_DLZ --server-role=dc --use-rfc2307 
```

### HQ-CLI
```bash
apt-get update && apt-get install -y admx-* admc gpui sudo gpupdate
```
**–ó–∞—Ö–æ–¥–∏–º —á–µ—Ä–µ–∑ –≤–∫–ª–∞–¥–∫—É Console –≤–Ω—É—Ç—Ä–∏ Proxmox VE, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π —á–∞—Å—Ç–∏.**
```
login: user
password: resu
```
**–û—Ç–∫—Ä—ã–≤–∞–µ–º Firefox:** 
- –ü–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ –∞–¥—Ä–µ—Å—É 192.168.3.10:8080
- –î–∞–Ω–Ω—ã–µ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
```bash
login: root
password: toor
```
- Configuration > Expert mode > Apply
- Web Interface
- –ú–µ–Ω—è–µ–º –ø–æ—Ä—Ç 8080 –Ω–∞ 8081 > Apply > Restart http server
- –ü–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ –∞–¥—Ä–µ—Å—É 192.168.3.10:8081
- –í–∫–ª–∞–¥–∫–∞ Domain
- –í—ã–±–∏—Ä–∞–µ–º Active Directory Domain Controller
- DNS FORWARDS - 192.168.1.10
- Domain - au-team.irpo
- Password - P@ssw0rd
- Apply
- –ó–∞–ø—É—Å–∫–∞–µ–º –∏ –¥–æ–∂–∏–¥–∞–µ–º—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏—è - OK.

### BR-SRV:
**–ü–µ—Ä–µ–ø—É—Å–∫–∞–µ–º —Å–∏—Å—Ç–µ–º—É –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º**:
```bash
ping ya.ru
ping br-srv.au-team.irpo
ping hq-rtr.au-team.irpo
```
> –ï—Å–ª–∏ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - —Ç–æ –û–ö!

### HQ-CLI:
**–ü–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä—è–µ–º 192.168.3.10:8081**
- –ó–∞—Ö–æ–¥–∏–º –≤ Domain
> –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å OK, —Ç–æ –∏–¥–µ–º –¥–∞–ª—å—à–µ.
**–û—Ç —Ä—É—Ç–∞ –≤—ã–ø–æ–ª–Ω—è–µ–º:**
```bash
nmcli con add type ethernet ifname ens18 con-name "Wired Connection" \
	ipv4.method auto \
	ipv4.ignore-auto-dns yes \
	ipv4.dns 192.168.3.10
nmcli con down "System ens18"
nmcli con up "Wired Connection"
```
**–í –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –æ–±–æ–ª–æ—á–∫–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤ –∞–¥–∞–ø—Ç–µ—Ä–µ Networking, —É–±—Ä–∞—Ç—å –∏ –æ–±—Ä–∞—Ç–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –≥–∞–ª–æ—á–∫—É.**
**–î–∞–ª–µ–µ –≤ –∫–æ–Ω—Å–æ–ª–∏**:
```bash
acc
```
- –ü–∞—Ä–æ–ª—å toor
- –í—ã–±—Ä–∞—Ç—å Auth –≤ Networking
- –ü—Ä–æ–ø–∏—Å–∞—Ç—å au-team.irpo au-team –≤—ã–±—Ä–∞—Ç—å –ø—Ä–∏–Ω—è—Ç—å.
> –ï—Å–ª–∏ –≤—Ö–æ–¥ –≤ –¥–æ–º–µ–Ω –ø—Ä–æ–∏–∑–æ—à–µ–ª, —Ç–æ - –û–ö!
